tinymce.PluginManager.add('uploadvideo', function (ed, url) {
    url = tinyMCE.activeEditor.getParam('uploadvideo_rel') || url;

    var uploadvideoUrl = tinyMCE.activeEditor.getParam('uploadvideo_url');
    function showdiago() {

        layer.open({
            type: 1,
            skin: 'layui-layer-rim', //加上边框
            area: ['420px', '240px'], //宽高
            content:    '<form  method="POST"  enctype="multipart/form-data" id="uploadImageForm">' +
            '                                   <button type="button" class="layui-btn" id="video-0okonnnokokokokokokokokok" style="margin-top: 50px;margin-left: 130px  ">' +
            '                            <i class="layui-icon">&#xe67c;</i>上传视频' +
            '                        </button>'+
            ' <div class="layui-form-item"  id="uploading-video" style="position: relative  ;display: none" >'+
            ' <label class="layui-form-label">上传进度</label>'+
            ' <div class="layui-progress" lay-showpercent="true" lay-filter="process"'+
            '  style="  width: 60%;position: absolute;left: 110px;top:16px" >'+
                '<div class="layui-progress-bar layui-bg-green" lay-percent="0%"></div>'+
                ' </div> '+
            ' </div>'+
            '  </form>'
        });

        layui.use([ 'form', 'upload'], function () {
            var form = layui.form
                , $ = layui.jquery
                , upload = layui.upload
                , element = layui.element
            upload.render({
                url:  uploadvideoUrl
                , elem: '#video-0okonnnokokokokokokokokok'
                , ext: 'mp4|rm|rmvb|mpeg|mov|mtv|dat|wmv|avi| 3gp|amv'
                , auto: true
                , accept: 'video' //视频
                , progress: function (e, percent) {
                    element.progress('process', percent + "%");

                }
                , before: function (input) {
                    $('#uploading-video').css('display','block') ;
                }
                , done: function (res) {
                    layer.msg(res.msg, {icon: 1, time: 1000});
                    var tpl = '<video width="320" height="240" controls="controls">' +
                        '<source src="%s" type="video/mp4"></video>';
                    var tmppath = res.data.url;
                    console.log( tmppath);
                    ed.insertContent(tpl.replace('%s', tmppath));
                    ed.focus();
                    layer.closeAll('page'); //关闭所有页面层
                }, error: function () {
                    layer.close(index);
                    layer.msg('上传出错：1', {
                        title: '提示'
                        //不自动关闭
                        , time: 1000
                        , icon: 5
                        , offset: '400px'
                    });
                }
            });

        });
    }

// Register commands
    ed.addCommand('uploadvideo', showdiago);


// Register buttons
    ed.addButton('uploadvideo', {
        title: '插入视频',
        cmd: 'uploadvideo',
        image: url + '/img/icon.ico',
    });


})
;